{"ts":1342449909131,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"dojo.require(\"esri.map\");\r\ndojo.require(\"esri.arcgis.utils\");\r\ndojo.require('esri.arcgis.Portal');\r\ndojo.require(\"esri.IdentityManager\");\r\ndojo.require(\"dijit.dijit\");\r\ndojo.require(\"dijit.layout.BorderContainer\");\r\ndojo.require(\"dijit.layout.ContentPane\");\r\n\r\nvar _map,\r\n\t_points,\r\n\t_selPos;\r\n\r\nvar initMap = function(){\r\n\r\n\tvar initExtent = new esri.geometry.Extent({\"xmin\":-15440190.518952178,\"ymin\":-4384014.805557845,\"xmax\":16259773.85146766,\"ymax\":10174487.34974608,\"spatialReference\":{\"wkid\":102100}});\r\n\r\n\t_map = new esri.Map(\"map\",{\r\n\t\textent:initExtent,\r\n\t\twrapAround180:true\r\n\t});\r\n\r\n\tvar basemap = new esri.layers.ArcGISTiledMapServiceLayer(\"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer\");\r\n\t_map.addLayer(basemap);\r\n\r\n\t_points = new esri.layers.GraphicsLayer();\r\n\t_map.addLayer(_points);\r\n\r\n\taddPoints();\r\n\r\n\tdojo.forEach(_points.graphics,function(g){\r\n\t\tif(g.attributes.rlcategory !== \"VU\"){\r\n\t\t\tg.hide();\r\n\t\t}\r\n\t});\r\n\r\n\tdojo.connect(_map, 'onLoad', function(theMap) {\r\n\t\t//resize the map when the browser resizes\r\n\t\tdojo.connect(dijit.byId('map'), 'resize', _map,_map.resize);\r\n\t});\r\n\r\n\tdojo.connect(_points,\"onMouseOver\",function(event){\r\n\t\t_map.setCursor(\"pointer\");\r\n\t\tevent.graphic.setSymbol(event.graphic.symbol.setHeight(30).setWidth(37).setOffset(10,14));\r\n        $(\"#hoverInfo\").html(\"\").append(\"<table><tr><td id='speciesName'>\" + event.graphic.attributes.COMMON_NAME + \"</td><td id='arrowCon' rowspan='2'><div id='popupArrow'></div></tr><tr><td id='thumbnailCon'><img id='speciesThmb' src='http://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Siberischer_tiger_de_edit02.jpg/250px-Siberischer_tiger_de_edit02.jpg' alt='\" + event.graphic.attributes.COMMON_NAME + \"'</td></tr></table>\");\r\n        positionHoverInfo(event.graphic.geometry);\r\n\t});\r\n\r\n\tdojo.connect(_map,\"onMouseOut\",function(){\r\n\t\t_map.setCursor(\"default\");\r\n\t\tevent.graphic.setSymbol(event.graphic.symbol.setHeight(25).setWidth(31).setOffset(8,12));\r\n        $(\"#hoverInfo\").hide();\r\n        $(\"#hoverInfoPointer\").hide();\r\n\t});\r\n\r\n\tdojo.connect(_points,\"onClick\",function(){\r\n\t\t_map.setCursor(\"default\");\r\n\t});\r\n\r\n    dojo.connect(_map,\"onPan\",function(){\r\n    });\r\n};\r\n\r\nvar addPoints = function(){\r\n\tdojo.forEach(_pointData.features,function(ftr){\r\n\t\tvar pt = new esri.geometry.Point( {\"x\": ftr.geometry.x, \"y\": ftr.geometry.y,\" spatialReference\": {\" wkid\": 102100 } });\r\n\r\n\t\tvar attr = ftr.attributes;\r\n\r\n\t\tvar sym;\r\n\t\tif(attr.class === \"MAMMALIA\"){\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Mammal_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\t\telse if(attr.class === \"REPTILIA\"){\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Reptile_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\t\telse if(attr.class === \"INSECTA\"){\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Insect_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\t\telse if(attr.class === \"CRUSTACEA\"){\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Crustacean_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\t\telse if(attr.class === \"GASTROPODA\"){\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Gastropod_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\t\telse if(attr.class === \"AMPHIBIA\"){\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Amphibian_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\t\telse if(attr.kingdom === \"PLANTAE\"){\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Plant_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tsym = new esri.symbol.PictureMarkerSymbol('images/icons/Fish_icon.png', 31, 25).setOffset(8,12);\r\n\t\t}\r\n\r\n\r\n\t\t_points.add(new esri.Graphic(pt,sym,attr));\r\n\r\n\t\t$(\"#speciesList\").append(\"<div id='species\" + attr.OBJECTID + \"' class='speciesItem'>\" + attr.COMMON_NAME + \"</div>\");\r\n\t\t$(\"#species\"+attr.OBJECTID).data(\"attributes\",attr);\r\n        $(\"#species\"+attr.OBJECTID).append(\"<span class='arrow'></span>\");\r\n\r\n        $(\".speciesItem\").click(function(){\r\n            $(\".speciesItem\").removeClass(\"selectedItem\");\r\n            $(this).addClass(\"selectedItem\");\r\n            $(\".arrow\").hide();\r\n            $(this).children(\".arrow\").show();\r\n        });\r\n\t});\r\n};\r\n\r\nvar sortGraphics = function(){\r\n\tvar arg;\r\n\tif ($(\"#selectedText\").html() === \"LEAST<br>CONCERN\"){\r\n\t\targ = \"LC\";\r\n\t}\r\n\telse if ($(\"#selectedText\").html() === \"NEAR<br>THREATENED\"){\r\n\t\targ = \"NT\";\r\n\t}\r\n\telse if ($(\"#selectedText\").html() === \"VULNERABLE\"){\r\n\t\targ = \"VU\";\r\n\t}\r\n\telse if ($(\"#selectedText\").html() === \"ENDANGERED\"){\r\n\t\targ = \"EN\";\r\n\t}\r\n\telse{\r\n\t\targ = \"CR\";\r\n\t}\r\n\tdojo.forEach(_points.graphics,function(g){\r\n\t\tg.show();\r\n\t\tif(g.attributes.rlcategory !== arg){\r\n\t\t\tg.hide();\r\n\t\t}\r\n\t});\r\n};\r\n\r\nvar positionHoverInfo = function(grp){\r\n    var popupHeight = $(\"#arrowCon\").height();\r\n\r\n    console.log(_map.toScreen(grp));\r\n\r\n    $(\"#hoverInfo\").css(\"left\",_map.toScreen(grp).x - 13).css(\"top\",_map.toScreen(grp).y + 17)\r\n    $(\"#hoverInfoPointer\").css(\"left\",_map.toScreen(grp).x-13).css(\"top\",_map.toScreen(grp).y + 2)\r\n    $(\"#hoverInfo\").show();\r\n    $(\"#hoverInfoPointer\").show();\r\n};"]],"start1":0,"start2":0,"length1":0,"length2":5071}]],"length":5071}
